<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body{font-family: Roboto, Arial; padding:12px; max-width: 600px; margin: auto;}
      label{display:block;margin-top:12px; font-weight: 600;}
      input, textarea {width:100%; padding:10px; box-sizing:border-box; border: 1px solid #ccc; border-radius: 4px; margin-top: 4px;}
      textarea {resize: vertical;}
      button{margin-top:20px;padding:12px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%; font-size: 16px;}
      button:hover {background-color: #45a049;}
      .hint {font-size: 0.85em; color: #666; margin-top: 2px;}
    </style>
  </head>
  <body>
    <h3>สร้าง Vault (Secret Keeper)</h3>
    <div class="hint" style="margin-top: 0; color: #cc0000; font-weight: bold;">
      ⚠️ ข้อสำคัญ: กรุณาอนุญาตสิทธิ์ Google Account ให้ถูกต้องเพื่อให้ระบบสามารถเข้าถึงไฟล์ได้
    </div>

    <div>
      <label for="vaultTitle">ชื่อ Vault</label>
      <input id="vaultTitle" placeholder="เช่น พินัยกรรมฉบับที่ 2" />

      <label for="secretContent">เนื้อหา (ข้อความหลัก)</label>
      <textarea id="secretContent" rows="8" placeholder="พิมพ์ข้อความที่ต้องการเก็บ เช่น คำสั่ง, รหัสผ่านสำคัญ, คำบอกลา"></textarea>
      <div class="hint">ข้อความนี้จะถูกบันทึกใน Google Doc ใหม่</div>

      <label for="filesFolderUrlOrId">ลิงก์/ID ไฟล์แนบ (PDF, VDO, รูปถ่าย)</label>
      <input id="filesFolderUrlOrId" placeholder="วาง Google Drive URL หรือ ID ของไฟล์/โฟลเดอร์" />
      <div class="hint">ระบบจะแชร์ไฟล์/โฟลเดอร์นี้ให้ Trustees เมื่อถึงเวลาเปิดเผยความลับ (ไม่บังคับ)</div>

      <label for="trustees">Trusted contacts (คั่นด้วย comma)</label>
      <input id="trustees" placeholder="b@example.com, c@example.com" />
      <div class="hint">อีเมลของผู้รับความลับ (Trustees)</div>

      <label for="checkinDays">Check-in interval (days)</label>
      <input id="checkinDays" type="number" value="90" min="1" />
      <div class="hint">ต้องเช็กอินทุก ๆ กี่วัน</div>

      <label for="graceHours">Grace period (hours)</label>
      <input id="graceHours" type="number" value="12" min="1" />
      <div class="hint">ระยะเวลาผ่อนผันหลังครบกำหนดเช็กอิน ก่อนเปิดเผยความลับ</div>
      
      <div style="margin-top:12px">
        <button onclick="submitForm()">Create Vault</button>
      </div>
      <div id="status" style="margin-top:20px; font-weight: bold;"></div>
    </div>

    <script>
      function submitForm(){
        const data = {
          vaultTitle: document.getElementById('vaultTitle').value,
          secretContent: document.getElementById('secretContent').value,
          filesFolderUrlOrId: document.getElementById('filesFolderUrlOrId').value, // NEW
          trusteesCSV: document.getElementById('trustees').value,
          checkinDays: document.getElementById('checkinDays').value,
          graceHours: document.getElementById('graceHours').value
        };
        
        document.getElementById('status').textContent = '⏳ กำลังสร้าง Vault และตรวจสอบไฟล์แนบ... โปรดรอสักครู่';
        document.getElementById('status').style.color = '#FFA500';

        google.script.run.withSuccessHandler(function(resp){
          if (resp.ok) {
            let msg = '✅ สร้าง Vault สำเร็จ! เอกสารหลัก: ' + resp.docUrl;
            if (resp.filesFolderUrl) {
                msg += ' | ไฟล์แนบ: ' + resp.filesFolderUrl;
            }
            document.getElementById('status').textContent = msg;
            document.getElementById('status').style.color = '#4CAF50';
          } else {
            document.getElementById('status').textContent = '❌ เกิดข้อผิดพลาด: ' + (resp.error || 'ไม่สามารถสร้าง Vault ได้');
            document.getElementById('status').style.color = '#cc0000';
          }
        }).submitVault(data);
      }
    </script>
  </body>
</html>
