<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body{font-family: Roboto, Arial; padding:12px;}
      label{display:block;margin-top:8px}
      input, textarea {width:100%; padding:8px; box-sizing:border-box}
      button{margin-top:12px;padding:10px 16px}
    </style>
  </head>
  <body>
    <h3>สร้าง Vault (Secret Keeper)</h3>
    <div>
      <label>ชื่อ Vault</label>
      <input id="vaultTitle" placeholder="เช่น พินัยกรรม" />
      <label>เนื้อหา (ความลับ)</label>
      <textarea id="secretContent" rows="8" placeholder="พิมพ์ข้อความที่ต้องการเก็บ"></textarea>
      <label>Trusted contacts (คั่นด้วย comma) — ใส่อีเมลเท่านั้น</label>
      <input id="trustees" placeholder="b@example.com, c@example.com" />
      <label>Check-in interval (days)</label>
      <input id="checkinDays" type="number" value="90" />
      <label>Grace period (hours)</label>
      <input id="graceHours" type="number" value="12" />
      
      <!-- **REMOVED: Hidden Field for ownerLineId (No longer needed)** -->
      
      <div style="margin-top:12px">
        <button onclick="submitForm()">Create Vault</button>
      </div>
      <div id="status" style="margin-top:10px;color:green"></div>
    </div>

    <script>
      // **REMOVED: Logic to parse ownerLineId from URL (No longer needed)**
      
      function submitForm(){
        const data = {
          // **REMOVED: ownerLineId from data object**
          vaultTitle: document.getElementById('vaultTitle').value,
          secretContent: document.getElementById('secretContent').value,
          trusteesCSV: document.getElementById('trustees').value,
          checkinDays: document.getElementById('checkinDays').value,
          graceHours: document.getElementById('graceHours').value
        };
        document.getElementById('status').textContent = 'กำลังสร้าง Vault...';
        google.script.run.withSuccessHandler(function(resp){
          if (resp.ok) {
            document.getElementById('status').textContent = 'สร้างสำเร็จ! ดูได้ที่: ' + resp.docUrl;
          } else {
            // Display error message if Line ID is missing in Script Properties
            document.getElementById('status').textContent = 'เกิดข้อผิดพลาด: ' + (resp.error || 'ไม่สามารถสร้าง Vault ได้ โปรดตรวจสอบ LINE_user_ID ใน Script Properties');
          }
        }).submitVault(data);
      }
    </script>
  </body>
</html>
